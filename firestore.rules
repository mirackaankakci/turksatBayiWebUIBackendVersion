// Firebase Firestore Security Rules
// Bu kuralları Firebase Console > Firestore Database > Rules bölümünde ayarlayın

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Blog Categories koleksiyonu - herkese okuma, sadece adminler yazabilir
    match /blog_categories/{document} {
      allow read: if true;
      allow write: if isAdmin(request.auth);
    }
    
    // Blog Posts koleksiyonu - published olanları herkes okuyabilir, yazma yetkisi adminlerde
    match /blog_posts/{document} {
      allow read: if resource.data.status == 'published' || isAdmin(request.auth);
      allow write: if isAdmin(request.auth);
    }
    
    // Admin koleksiyonu - sadece adminler erişebilir
    match /admins/{adminId} {
      allow read, write: if isAdmin(request.auth);
      // Kendi profilini okuyabilir
      allow read: if request.auth != null && request.auth.uid == adminId;
    }
    
    // Admin kontrolü fonksiyonu
    function isAdmin(auth) {
      return auth != null && 
             exists(/databases/$(database)/documents/admins/$(auth.uid)) &&
             get(/databases/$(database)/documents/admins/$(auth.uid)).data.isActive == true;
    }
    
    // Diğer koleksiyonlar için varsayılan kurallar
    match /{document=**} {
      allow read, write: if false; // Sadece yukarıda tanımlanan kurallar geçerli
    }
  }
}

/*
KURULUM ADIMLARİ:

1. Firebase Console'a gidin
2. Projenizi seçin
3. Firestore Database > Rules sekmesine gidin
4. Bu kuralları kopyalayıp yapıştırın
5. Publish butonuna basın

6. INDEXES OLUŞTURUN:
   - Collection: blog_posts
     * Fields: status (Ascending), createdAt (Descending)
     * Fields: category (Ascending), createdAt (Descending)
     * Fields: status (Ascending), category (Ascending), createdAt (Descending)
   
   - Collection: admins
     * Fields: isActive (Ascending), role (Ascending)
     * Fields: isActive (Ascending), createdAt (Descending)

7. İLK ADMIN KULLANICISI OLUŞTURUN:
   src/scripts/createFirstAdmin.js dosyasını tarayıcı konsolunda çalıştırın
*/
